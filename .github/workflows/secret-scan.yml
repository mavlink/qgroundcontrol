name: Secret Scan

on:
  workflow_dispatch:
    inputs:
      scan_since:
        description: 'Scan commits since (e.g., "2024-01-01" or "HEAD~100")'
        required: false
        default: ''
      include_history:
        description: 'Scan full git history'
        type: boolean
        default: false

permissions:
  contents: read

jobs:
  trufflehog:
    name: TruffleHog Secret Scan
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: TruffleHog Scan
        uses: trufflesecurity/trufflehog@main
        with:
          extra_args: >-
            --config=.github/trufflehog.yaml
            ${{ inputs.include_history && '--since-commit=HEAD~500' || '--since-commit=HEAD~50' }}
            ${{ inputs.scan_since && format('--since-commit={0}', inputs.scan_since) || '' }}
